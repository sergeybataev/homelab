apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  name: &app podinfo
spec:
  postBuild:
    substituteFrom:
      - kind: ConfigMap
        name: cluster-settings
      - kind: Secret
        name: cluster-secrets
      - kind: ConfigMap
        name: cluster-config-versions
        optional: false
      - kind: ConfigMap
        name: cluster-settings-user
        optional: true
      - kind: Secret
        name: cluster-secrets-user
        optional: true
      - kind: Secret
        name: cluster-secrets-test
        optional: true

  # was inlined
  #
  # - patch: |-
  #     apiVersion: kustomize.toolkit.fluxcd.io/v1
  #     kind: Kustomization
  #     metadata:
  #       name: not-used
  #     spec:
  #       postBuild:
  #         substituteFrom:
  #           - kind: ConfigMap
  #             name: cluster-settings
  #           - kind: Secret
  #             name: cluster-secrets
  #           - kind: ConfigMap
  #             name: cluster-config-versions
  #             optional: false
  #           - kind: ConfigMap
  #             name: cluster-settings-user
  #             optional: true
  #           - kind: Secret
  #             name: cluster-secrets-user
  #             optional: true
  #   target:
  #     group: kustomize.toolkit.fluxcd.io
  #     kind: Kustomization
  #     labelSelector: substitution.flux.home.arpa/disabled notin (true)
